<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>
    <script>
        const socket = io();
    </script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <ul>
        <img src="{{ url_for('static', filename='logo/logo_bw.svg') }}" width=36 height=36></img>
        <li><span style="color:#aaa">channel:</span> {{ channel_name }}</li>
        <li style="float:right" class="profbtn">
            <a>{{ current_user.username }}<a>
            <div class="dropdown-content">
                <a href="/logout">logout</a>    
            </div>
        </li>
    </ul>
    <h1></h1>

    <div id="content">
        <div id="con">
            <div id="msgr"></div>
        </div>
            
        <form autocomplete="off" id="msginput">
            {{ form.message(id="msgbox") }}
            <input type="submit" value="send">
        </form>
    </div>
    <script>
        $("form").submit(function(e){
            if ($("#msgbox").val() != "") {
                socket.emit("message", {  message: $("#msgbox").val(), channel_id: "{{ channel_id }}", user_id: "{{ current_user.id }}" });
                $("form").trigger("reset");
            }
            e.preventDefault();
        });
        socket.on("msg",function() {
            $("#msgr").load("/channel/{{ channel_id }}");
        });
        function reloadMessages() {
        $("#msgr").load("/channel/{{ channel_id }}");
        }
    </script>
</body onload="reloadMessages">