<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>
    <script>
        const socket = io();
    </script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>{{ channel_name }} - Pixidle</title>
</head>

<body>
    <ul>
        <img src="{{ url_for('static', filename='logo/logo_bw.svg') }}" width=36 height=36></img>
        <li><span style="color:#aaa">channel:</span> {{ channel_name }}</li>
        <li style="float:right" class="profbtn">
            <a>{{ current_user.username }}<a>
            <div class="dropdown-content">
                <a href="/accountsettings">settings</a> 
                <a href="/logout">logout</a>    
            </div>
        </li>
    </ul>

    <div id="content">
        <div id="con">
            <div id="msgr"></div>
        </div>
            
        <form autocomplete="off" id="msginput">
            {{ form.message(id="msgbox", maxlength=100) }}
            <input type="submit" value=">">
        </form>
    </div>
    <script>
        $("form").submit(function(e){
            if ($("#msgbox").val() != "") {
                socket.emit("message", {  message: $("#msgbox").val(), channel_id: "{{ channel_id }}", user_id: "{{ current_user.id }}" });
                $("form").trigger("reset");
            }
            e.preventDefault();
        });
        socket.on("msg",function(data) {
            console.log(data)
            var m = $("<p> <img src="+data.img+" width='36' height='36' class='pfp'>"+data.name+": "+data.message+"</p>");
		    $('#msgr').append(m);
            
        });
    </script>
</body onload="reloadMessages">