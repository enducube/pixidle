<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>
    <script>
        const socket = io();
    </script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <h1>{{ channel_name }}</h1>
    <p>you are signed in as {{ current_user.username }}</p>
    <a href="/logout">logout</a>
    <div id="con"><div id="msgr"></div></div>
    <form>
        {{ form.message(id="msgbox") }}
        <input type="submit" value="send">
    </form>
    <script>
        $("form").submit(function(e){
            socket.emit("message", {  message: $("#msgbox").val(), channel_id: "{{ channel_id }}", user_id: "{{ current_user.id }}" });
            $("form").trigger("reset");
            e.preventDefault();
        });
        socket.on("msg",function() {
            $("#msgr").load("/channel/{{ channel_id }}");
        });
        function reloadMessages() {
        $("#msgr").load("/channel/{{ channel_id }}");
        }
    </script>
</body onload="reloadMessages">